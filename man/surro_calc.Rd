% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/surro_calc.R
\name{surro_calc}
\alias{surro_calc}
\title{Calculate Predicted Values from methyl_surro Object}
\usage{
surro_calc(
  methyl_surro,
  transform = c("linear", "count", "probability"),
  verbose = FALSE,
  return_diagnostics = FALSE
)
}
\arguments{
\item{methyl_surro}{An object of class \code{methyl_surro}.}

\item{transform}{A character string specifying the transformation to apply. Can be \code{"linear"}, \code{"count"}, or \code{"probability"}.}

\item{verbose}{Logical. If \code{TRUE}, detailed progress and diagnostic messages are displayed. Default is \code{FALSE}.}

\item{return_diagnostics}{Logical. If \code{TRUE}, returns additional diagnostic information. Default is \code{FALSE}.}
}
\value{
If \code{return_diagnostics = FALSE}: A named vector of predicted values with names corresponding to the sample names.
If \code{return_diagnostics = TRUE}: A list containing:
\describe{
\item{predictions}{The named vector of predicted values}
\item{diagnostics}{A list of diagnostic information including missing data handling and calculation details (see Diagnostics section)}
}
}
\description{
This function calculates predicted values based on the provided methyl_surro object.
If any probes (rows) are completely missing, their values are set to zero.
Samples with any missing values are removed from the calculation. The function aligns
and multiplies the weights with the methylation matrix, adds the intercept if specified,
and applies the specified transformation to the results.
}
\details{
The function performs validation and processing steps:
\itemize{
\item Validates probe-weight alignment between methylation data and weights
\item Sets completely missing probes to zero
\item Removes samples with any missing values
\item Calculates weighted sums and applies transformations
\item Provides detailed feedback about data processing
}
}
\section{Transformation Equations}{

The surrogate biomarker value for each sample is calculated using the following equations,
where \eqn{X} is the methylation matrix, \eqn{w} is the weight vector, and \eqn{b} is the intercept:

\strong{Linear transformation (\code{transform = "linear"}):}
\deqn{y = X^T w + b}
This is the raw weighted sum of methylation values, suitable for continuous outcomes
such as estimated cell counts or continuous biomarker values.

\strong{Count transformation (\code{transform = "count"}):}
\deqn{y = \exp(X^T w + b)}
This applies an exponential transformation to the linear predictor, appropriate for
count-based outcomes following a log-linear model (e.g., Poisson regression results).
Values are constrained to be positive.

\strong{Probability transformation (\code{transform = "probability"}):}
\deqn{y = \frac{1}{1 + \exp(-(X^T w + b))}}
This applies the inverse logit (logistic) transformation, converting the linear predictor
to a probability scale (range: 0 to 1). Appropriate for binary outcomes or risk scores derived
from logistic regression models.
}

\section{Diagnostics}{

When \code{return_diagnostics = TRUE}, the function returns a list where the \code{diagnostics}
component contains detailed information about the calculation:
\describe{
\item{transform}{Character string indicating which transformation was applied}
\item{n_samples_original}{Number of samples in the input methylation matrix}
\item{n_probes_original}{Number of probes (rows) in the input methylation matrix}
\item{n_weights}{Number of weights provided}
\item{intercept_used}{Logical indicating whether an intercept was included}
\item{n_common_probes}{Number of probes present in both weights and methylation data}
\item{n_missing_in_weights}{Number of probes in methylation data without corresponding weights}
\item{n_missing_in_methyl}{Number of weight probes not found in methylation data}
\item{n_completely_missing_probes}{Number of probes with all NA values (set to zero)}
\item{n_samples_with_missing}{Number of samples containing any NA values (removed)}
\item{probes_set_to_zero}{Same as n_completely_missing_probes}
\item{samples_removed}{Same as n_samples_with_missing}
\item{n_final_samples}{Number of samples in the final prediction vector}
\item{final_result_range}{Named numeric vector with min and max values of predictions}
}
}

\examples{
# Load sample data
data(beta_matrix_comp, package = "MethylSurroGetR")
data(wts_df, package = "MethylSurroGetR")

# Create weight vector and methyl_surro object
wts_vec_lin <- setNames(wts_df$wt_lin, rownames(wts_df))
methyl_surro_comp <- surro_set(beta_matrix_comp, wts_vec_lin, "Intercept")

# Basic calculation
pred_lin <- surro_calc(methyl_surro_comp, transform = "linear")
print(pred_lin)

# With diagnostic information
result_detailed <- surro_calc(methyl_surro_comp,
                              transform = "linear",
                              return_diagnostics = TRUE,
                              verbose = TRUE)
print(result_detailed$diagnostics)

}
